# CandlesAlgoritm

Проект на Fortran + Cairo + Docker, для построения графиков типа японских свечей (OHLC) на основе биржевых данных.

![Candlestick chart example](https://raw.githubusercontent.com/muzungu-av/CandlesAlgoritm/main/output/chart.png)


## Структура проекта

```
/
├── bybit_api_mod.f90        — модуль для получения данных с Bybit API (HTTP / JSON)
├── cairo_interface.f90      — интерфейсы к библиотеке Cairo
├── candle_mod.f90           — модуль рисования одной свечи
├── levels_mod.f90           — модуль построения и подписей уровней
├── main.f90                  — основная точка входа (загрузка данных, построение)
├── Dockerfile               — для сборки контейнера с Fortran + Cairo
├── docker-compose.yml       — конфигурация для запуска контейнера + монтирования volume
├── candle_app               — (собранный) бинарник (игнорируется в Git или как артефакт)
└── output/                   — папка, куда сохраняются PNG графики
```

## Требования и зависимости

- Компилятор Fortran (например, `gfortran`)  
- Библиотека Cairo (`libcairo2-dev` в Debian-подобных системах)  
- Среда Docker / Docker Compose (для контейнерной сборки и изоляции)

## Как запустить

1. Клонировать репозиторий:

   ```bash
   git clone https://github.com/muzungu-av/CandlesAlgoritm.git
   cd CandlesAlgoritm
   ```

2. Собрать и запустить через Docker Compose:

   ```bash
   docker-compose up --build
   ```

   Это создаст контейнер, соберёт приложение, выполнит его внутри, и выведет PNG-файл в локальную папку `output/`.

3. После завершения (или в работающем контейнере) проверить файл:

   ```bash
   ls output/
   # ожидать chart.png
   ```

4. (Опционально) Запустить напрямую (на хост-машине, если установлены все зависимости):

   ```bash
   ./candle_app
   ```

## Логика работы и особенности

- В `main.f90` данные свечей (OHLC) хранятся в массивах. В будущем эти массивы можно заполнять автоматически (через `bybit_api_mod`).  
- Каждая свеча рисуется через `candle_mod.draw_candle`, где:
  - Цвет тела зависит от отношения `close` и `open` (зелёный/красный/dоdхи).  
  - Фитиль рисуется между `low` и `high`.  
- Уровни цен (горизонтальные линии) рисуются через `levels_mod.draw_levels`:
  - Используется алгоритм “nice axis ticks” — шаг подбирается к “красивому” числу (1, 2, 5 и т.д.).  
  - Если уровень близок к целому, выводится без дробей (например, `11.0`), иначе с нужным количеством знаков после запятой.  
- Все вертикальные координаты масштабируются, чтобы свечи заняли ~90% высоты картинки, с отступом сверху/снизу.

## Пример

После запуска ты получишь файл в `output/chart.png`, который покажет график свечей со “красивыми” уровнями цен (например, уровни `13.0`, `12.0`, `11.0`, `10.0`), где тело свечи окрашено в зелёный или красный, а фитили показывают экстремумы.
